<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether Panel</title>
    <link rel="icon" href="/logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>
</head>
<body>
    <div class="bg-particles"></div>

    <div id="editor-modal" class="modal-overlay" style="display:none">
        <div class="modal glass">
            <div class="modal-header">
                <h3><i class="fa-solid fa-code"></i> Editor</h3>
                <div class="modal-actions">
                    <button class="btn btn-ghost" onclick="closeEditor()">Cerrar</button>
                    <button class="btn btn-primary" onclick="saveFile()"><i class="fa-solid fa-floppy-disk"></i> Guardar</button>
                </div>
            </div>
            <div id="ace-editor"></div>
        </div>
    </div>

    <div id="version-modal" class="modal-overlay" style="display:none">
        <div class="modal glass version-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-cloud"></i> Repositorio</h3>
                <button class="btn btn-ghost btn-icon" onclick="closeAllModals()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="mod-search" style="padding:0 24px 20px 24px">
                <div class="search-wrapper">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                    <input type="text" id="store-search" placeholder="Buscar..." class="search-input" autofocus>
                </div>
                <span id="loading-text" style="display:none;font-size:12px;color:var(--p);margin-top:10px;"><i class="fa-solid fa-spinner fa-spin"></i> Cargando...</span>
            </div>
            <div id="version-list" class="version-grid"></div>
        </div>
    </div>

    <div id="ram-modal" class="modal-overlay" style="display:none">
        <div class="modal glass ram-modal" style="height:auto;max-width:500px">
            <div class="modal-header">
                <h3><i class="fa-solid fa-memory"></i> Asignar RAM</h3>
                <button class="btn btn-ghost btn-icon" onclick="closeRamModal()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div style="padding:30px;display:flex;flex-direction:column;gap:20px">
                <p style="color:var(--muted)">Selecciona la cantidad de RAM para el servidor:</p>
                <div class="range-wrapper">
                    <input type="range" id="ram-slider" min="1" max="16" step="0.5" class="ram-range" oninput="updateRamDisplay(this.value)">
                    <div class="ram-display"><span id="ram-display-val">4</span> GB</div>
                </div>
                <p style="font-size:0.8rem;color:var(--muted)">Disponible en sistema: <span id="sys-ram-total">0</span> GB</p>
                <button class="btn btn-primary" onclick="confirmInstall()">INSTALAR SERVIDOR</button>
            </div>
        </div>
    </div>

    <div id="update-modal" class="modal-overlay" style="display:none">
        <div class="modal glass update-modal">
            <div class="update-icon-wrapper"><i class="fa-solid fa-bolt"></i></div>
            <h3 id="up-title">Actualización</h3>
            <p id="update-text" style="color:var(--muted); margin-bottom:20px">...</p>
            <div id="up-actions" style="display:flex; flex-direction:column; gap:10px"></div>
        </div>
    </div>

    <div class="app-layout">
        
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo"><img src="/logo.svg" alt="Logo" style="width:24px;height:24px"></div>
                <div class="brand-text">
                    <span class="version-badge" id="sidebar-version-text">V1.5.0</span>
                    <span class="brand-name">AETHER</span>
                </div>
            </div>
            <nav>
                <div class="nav-label">CORE</div>
                <button onclick="setTab('stats', this)" class="nav-btn active"><i class="fa-solid fa-chart-simple"></i><span>Monitor</span></button>
                <button onclick="setTab('console', this)" class="nav-btn"><i class="fa-solid fa-terminal"></i><span>Consola</span></button>
                
                <div class="nav-label">DATA</div>
                <button onclick="setTab('files', this)" class="nav-btn"><i class="fa-solid fa-folder-tree"></i><span>Archivos</span></button>
                <button onclick="setTab('versions', this)" class="nav-btn"><i class="fa-solid fa-layer-group"></i><span>Núcleos</span></button>
                <button onclick="openModStore()" class="nav-btn"><i class="fa-solid fa-puzzle-piece"></i><span>Mods</span></button>
                <button onclick="setTab('backups', this)" class="nav-btn"><i class="fa-solid fa-box-archive"></i><span>Backups</span></button>
                <button onclick="setTab('labs', this)" class="nav-btn"><i class="fa-solid fa-flask"></i><span>Labs</span></button>
                <button onclick="setTab('config', this)" class="nav-btn"><i class="fa-solid fa-sliders"></i><span>Ajustes</span></button>
            </nav>
            <div class="sidebar-footer">
                <div class="theme-switcher">
                    <button onclick="setTheme('light')" class="theme-btn" title="Claro"><i class="fa-solid fa-sun"></i></button>
                    <button onclick="setTheme('dark')" class="theme-btn active" title="Oscuro"><i class="fa-solid fa-moon"></i></button>
                    <button onclick="setTheme('auto')" class="theme-btn" title="Sistema"><i class="fa-solid fa-desktop"></i></button>
                </div>
                <div class="status-widget OFFLINE" id="status-widget">
                    <div class="status-indicator"></div>
                    <span id="status-text">OFFLINE</span>
                </div>
            </div>
        </aside>

        <main>
            <header>
                <div class="server-info">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <h1>Aether Panel</h1>
                        <div class="badges">
                            <span class="badge badge-primary" id="header-version">V1.5.0</span>
                            <span class="badge badge-success">Stable</span>
                        </div>
                    </div>
                    <div class="server-ip-box" onclick="copyIP()" title="Click para copiar IP">
                        <i class="fa-solid fa-network-wired"></i>
                        <span id="server-ip-display">Cargando IP...</span>
                        <i class="fa-regular fa-copy" style="margin-left:auto;opacity:0.5"></i>
                    </div>
                </div>

                <div class="actions">
                    <button onclick="api('power/start')" class="btn-control start" title="Iniciar"><i class="fa-solid fa-play"></i></button>
                    <button onclick="api('power/restart')" class="btn-control restart" title="Reiniciar"><i class="fa-solid fa-rotate-right"></i></button>
                    <button onclick="api('power/stop')" class="btn-control stop" title="Detener"><i class="fa-solid fa-power-off"></i></button>
                    <button onclick="api('power/kill')" class="btn-control kill" title="Forzar Apagado"><i class="fa-solid fa-skull-crossbones"></i></button>
                </div>
            </header>

            <div id="tab-stats" class="tab-content active">
                <div class="stats-grid">
                    <div class="card glass">
                        <div class="card-header"><h3><i class="fa-solid fa-microchip"></i> CPU</h3><span class="stat-value" id="cpu-val">0%</span></div>
                        <div class="chart-container"><canvas id="cpuChart"></canvas></div>
                        <div class="stat-detail"><span>Frecuencia:</span> <span id="cpu-freq">0 MHz</span></div>
                    </div>
                    <div class="card glass">
                        <div class="card-header"><h3><i class="fa-solid fa-memory"></i> RAM</h3><span class="stat-value" id="ram-val">0 MB</span></div>
                        <div class="chart-container"><canvas id="ramChart"></canvas></div>
                        <div class="stat-detail"><span>Libre:</span> <span id="ram-free">0 MB</span></div>
                    </div>
                    <div class="card glass">
                        <div class="card-header"><h3><i class="fa-solid fa-hard-drive"></i> Disco</h3><span class="stat-value" id="disk-val">...</span></div>
                        <div class="disk-bar"><div class="disk-fill" id="disk-fill"></div></div>
                    </div>
                </div>
            </div>

            <div id="tab-console" class="tab-content">
                <div class="console-box">
                    <div style="padding-bottom:10px; border-bottom:1px solid var(--border); font-weight:700; color:var(--muted); display:flex; justify-content:space-between; align-items:center; font-size:0.9rem;">
                        <span><i class="fa-solid fa-terminal" style="color:var(--p)"></i> TERMINAL EN VIVO</span>
                    </div>
                    
                    <div id="terminal" style="flex:1; min-height:0;"></div>
                    
                    <div class="search-wrapper" style="margin-top:10px;">
                        <i class="fa-solid fa-chevron-right search-icon" style="color:var(--p)"></i>
                        <input type="text" id="console-input" placeholder="Escribe un comando..." class="search-input" 
                               onkeydown="if(event.key==='Enter') sendConsoleCommand()">
                        <button class="btn btn-sm btn-primary" onclick="sendConsoleCommand()">Enviar</button>
                    </div>
                </div>
            </div>

            <div id="tab-files" class="tab-content">
                <div class="card glass full">
                    <div class="card-header">
                        <div class="breadcrumb" id="file-breadcrumb"><i class="fa-solid fa-folder-open"></i> /root</div>
                        <div class="header-actions">
                            <button onclick="loadFileBrowser(currentPath)" class="btn btn-ghost btn-icon"><i class="fa-solid fa-rotate"></i></button>
                            <button onclick="uploadFile()" class="btn btn-primary"><i class="fa-solid fa-upload"></i> Subir</button>
                        </div>
                    </div>
                    <div id="file-list" class="file-list"></div>
                </div>
            </div>

            <div id="tab-versions" class="tab-content">
                <h2 class="tab-title" style="margin-bottom:20px;font-weight:700">Núcleos Disponibles</h2>
                <div class="versions-container">
                    <div class="version-card glass" onclick="loadVersions('vanilla')">
                        <div class="v-icon" style="background:linear-gradient(135deg, #27ae60, #229954)"><i class="fa-solid fa-cube"></i></div>
                        <div class="v-info"><h3>Vanilla</h3><p>Oficial</p></div><i class="fa-solid fa-arrow-right version-arrow"></i>
                    </div>
                    <div class="version-card glass" onclick="loadVersions('paper')">
                        <div class="v-icon" style="background:linear-gradient(135deg, #2980b9, #1f618d)"><i class="fa-solid fa-paper-plane"></i></div>
                        <div class="v-info"><h3>Paper</h3><p>Optimizado</p></div><i class="fa-solid fa-arrow-right version-arrow"></i>
                    </div>
                    <div class="version-card glass" onclick="loadVersions('fabric')">
                        <div class="v-icon" style="background:linear-gradient(135deg, #f39c12, #d68910)"><i class="fa-solid fa-scroll"></i></div>
                        <div class="v-info"><h3>Fabric</h3><p>Mods</p></div><i class="fa-solid fa-arrow-right version-arrow"></i>
                    </div>
                    <div class="version-card glass" onclick="loadVersions('forge')">
                        <div class="v-icon" style="background:linear-gradient(135deg, #c0392b, #a93226)"><i class="fa-solid fa-hammer"></i></div>
                        <div class="v-info"><h3>Forge</h3><p>Ilimitado</p></div><i class="fa-solid fa-arrow-right version-arrow"></i>
                    </div>
                </div>
            </div>

            <div id="tab-backups" class="tab-content">
                <div class="card glass full">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-clock-rotate-left"></i> Backups</h3>
                        <button onclick="createBackup()" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Crear</button>
                    </div>
                    <div id="backup-list" class="file-list"></div>
                </div>
            </div>

            <div id="tab-labs" class="tab-content">
                <h2 class="tab-title" style="margin-bottom:10px;font-weight:700">Aether Labs <span class="badge badge-warning">Experimental</span></h2>
                <p style="color:var(--muted);margin-bottom:20px">Funciones avanzadas. Úsalas bajo tu propio riesgo.</p>
                <div class="labs-grid">
                    <div class="card glass">
                        <div class="card-header">
                            <h3><i class="fa-solid fa-bolt"></i> Turbo Mode</h3>
                            <label class="switch"><input type="checkbox" id="lab-turbo"><span class="slider round"></span></label>
                        </div>
                        <p class="lab-desc">Prioriza el proceso de Java para mejorar el rendimiento.</p>
                    </div>
                </div>
            </div>

            <div id="tab-config" class="tab-content">
                <div class="card glass full">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-gear"></i> Configuración</h3>
                        <button onclick="saveNebulaConfig()" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Guardar</button>
                    </div>

                    <h4 style="margin-bottom:15px;color:var(--p-light)">Personalización</h4>
                    <div class="cfg-grid">
                        <div class="cfg-item">
                            <label class="cfg-label">Nombre del Servidor</label>
                            <input type="text" id="cfg-name" class="cfg-in" placeholder="Aether Panel">
                        </div>
                        <div class="cfg-item">
                            <label class="cfg-label">Color del Tema</label>
                            <div class="cfg-color-wrapper">
                                <input type="color" id="cfg-color" class="cfg-color" value="#8b5cf6">
                            </div>
                        </div>
                        <div class="cfg-item">
                            <label class="cfg-label">Partículas</label>
                            <div class="cfg-switch-wrapper">
                                <span style="font-size:0.85rem;color:var(--muted)">Efecto Fondo</span>
                                <label class="switch"><input type="checkbox" id="cfg-particles" checked><span class="slider round"></span></label>
                            </div>
                        </div>
                    </div>

                    <h4 style="margin-bottom:15px;color:var(--p-light);margin-top:20px">Propiedades (server.properties)</h4>
                    <div id="cfg-list" class="cfg-grid"></div>

                    <div id="cfg-list" class="cfg-grid"></div>

                    <div class="config-footer" style="gap: 20px;">
                        <button onclick="checkUpdate()" class="btn btn-update">
                            <i class="fa-solid fa-rotate"></i>
                            <span>BUSCAR ACTUALIZACIONES</span>
                        </button>

                        <button onclick="forceUIUpdate()" class="btn btn-update" style="border-color: var(--p-light); color: var(--p-light);">
                            <i class="fa-solid fa-paintbrush"></i>
                            <span>ACTUALIZAR UI (GRÁFICA)</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="app.js"></script>
</body>
</html>
