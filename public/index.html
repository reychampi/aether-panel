<!DOCTYPE html>
<html lang="es" data-theme="dark" data-design="glass">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether Panel</title>
    <link rel="icon" href="/logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>
</head>
<body>
    <div class="bg-particles"></div>

    <div id="editor-modal" class="modal-overlay" style="display:none">
        <div class="modal glass">
            <div class="modal-header"><h3><i class="fa-solid fa-code"></i> Editor</h3><div class="modal-actions"><button class="btn btn-ghost" onclick="closeEditor()">Cerrar</button><button class="btn btn-primary" onclick="saveFile()">Guardar</button></div></div>
            <div id="ace-editor" style="height:100%; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;"></div>
        </div>
    </div>

    <div id="version-modal" class="modal-overlay" style="display:none">
        <div class="modal glass" style="max-height: 80vh;">
            <div class="modal-header"><h3><i class="fa-solid fa-cloud-arrow-down"></i> Instalar</h3><button class="btn btn-ghost" onclick="document.getElementById('version-modal').style.display='none'"><i class="fa-solid fa-xmark"></i></button></div>
            <div id="version-list" style="padding:24px; overflow-y:auto; display:grid; grid-template-columns:repeat(auto-fill, minmax(160px, 1fr)); gap:16px;"></div>
        </div>
    </div>

    <div id="appearance-modal" class="modal-overlay" style="display:none">
        <div class="modal glass" style="max-width: 480px; padding: 0; overflow: hidden;">
            
            <div class="modal-header" style="border:none; padding: 20px 24px;">
                <h3 style="font-weight: 800; font-size: 1.1rem; display:flex; align-items:center; gap:10px;">
                    <i class="fa-solid fa-paintbrush"></i> Personalización
                </h3>
                <button class="btn btn-ghost" onclick="document.getElementById('appearance-modal').style.display='none'" style="width:32px; height:32px; padding:0;">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div style="padding: 0 24px 24px 24px; display:flex; flex-direction:column; gap:20px;">
                
                <div class="settings-group-card">
                    <h4 class="settings-group-title">APARIENCIA</h4>
                    
                    <div class="setting-row">
                        <span class="setting-label">Tema</span>
                        <div class="segment-control">
                            <button id="theme-btn-light" onclick="setTheme('light')" class="seg-item"><i class="fa-solid fa-sun"></i></button>
                            <button id="theme-btn-dark" onclick="setTheme('dark')" class="seg-item active"><i class="fa-solid fa-moon"></i></button>
                            <button id="theme-btn-auto" onclick="setTheme('auto')" class="seg-item text">Auto</button>
                        </div>
                    </div>

                    <div class="setting-row">
                        <span class="setting-label">Diseño</span>
                        <div class="segment-control">
                            <button onclick="setDesign('glass')" id="modal-btn-glass" class="seg-item text active">Glass</button>
                            <button onclick="setDesign('material')" id="modal-btn-material" class="seg-item text">Flat</button>
                        </div>
                    </div>

                    <div class="setting-row">
                        <span class="setting-label">Acento</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="color-circle-wrapper">
                                <input type="color" id="accent-picker" onchange="setAccentColor(this.value)">
                            </div>
                            <button id="accent-mode-auto" onclick="setAccentMode('auto')" class="seg-btn-reset">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="settings-group-card">
                    <h4 class="settings-group-title" style="color: var(--warning);">MANTENIMIENTO</h4>
                    <div class="maint-grid">
                        <button onclick="checkUpdate()" class="maint-action-btn">
                            <div class="maint-icon green"><i class="fa-solid fa-cloud-arrow-down"></i></div>
                            <div class="maint-text">
                                <span class="maint-head">Actualizar</span>
                                <span class="maint-sub">Buscar versión</span>
                            </div>
                        </button>
                        
                        <button onclick="forceUIUpdate()" class="maint-action-btn">
                            <div class="maint-icon orange"><i class="fa-solid fa-rotate"></i></div>
                            <div class="maint-text">
                                <span class="maint-head">Recargar UI</span>
                                <span class="maint-sub">Reparar fallos</span>
                            </div>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="ram-modal" class="modal-overlay" style="display:none">
        <div class="modal glass modal-small">
            <div class="modal-header"><h3><i class="fa-solid fa-memory"></i> Asignar RAM</h3><button class="btn btn-ghost" onclick="document.getElementById('ram-modal').style.display='none'"><i class="fa-solid fa-xmark"></i></button></div>
            <div style="padding:30px; display:flex; flex-direction:column; gap:24px"><div style="display:flex; justify-content:space-between; align-items:center;"><span style="font-weight:700">Límite de Memoria</span><span id="ram-display-val" style="font-family:'JetBrains Mono'; color:var(--p); font-size:1.2rem; font-weight:bold">4 GB</span></div><input type="range" id="ram-slider" min="1" max="16" step="0.5" style="width:100%" oninput="document.getElementById('ram-display-val').innerText = this.value + ' GB'"><button class="btn btn-primary" style="width:100%" onclick="confirmInstall()">Confirmar</button></div>
        </div>
    </div>
    
    <div id="update-modal" class="modal-overlay" style="display:none"><div class="modal glass modal-small"><div class="modal-header"><h3>Actualización</h3></div><div style="padding:30px;text-align:center"><p id="update-text" style="margin-bottom:20px">...</p><div id="up-actions"></div></div></div></div>
    <div id="force-ui-modal" class="modal-overlay" style="display:none"><div class="modal glass modal-small"><div class="modal-header"><h3>Actualizar Interfaz</h3></div><div style="padding:30px; text-align:center"><p style="margin-bottom:20px; color:var(--muted)">Descargar última versión visual.</p><button onclick="confirmForceUI()" class="btn btn-primary" style="width:100%">CONFIRMAR</button></div></div></div>

    <div class="app-layout">
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo"><img src="/logo.svg" alt="A" style="width:20px;"></div>
                <span class="brand-name">AETHER</span>
                <span class="version-badge" id="sidebar-version-text">V1.6.0</span>
            </div>
            
            <nav>
                <div class="nav-label">Core</div>
                <button onclick="setTab('stats', this)" class="nav-btn active"><i class="fa-solid fa-chart-pie"></i><span>Monitor</span></button>
                <button onclick="setTab('console', this)" class="nav-btn"><i class="fa-solid fa-terminal"></i><span>Consola</span></button>
                <button onclick="setTab('versions', this)" class="nav-btn"><i class="fa-solid fa-layer-group"></i><span>Núcleos</span></button>
                
                <div class="nav-label">System</div>
                <button onclick="setTab('labs', this)" class="nav-btn"><i class="fa-solid fa-flask"></i><span>Labs</span></button>
                <button onclick="setTab('whitelist', this)" class="nav-btn"><i class="fa-solid fa-address-book"></i><span>Whitelist</span></button>
                <button onclick="setTab('config', this)" class="nav-btn"><i class="fa-solid fa-sliders"></i><span>Ajustes</span></button>
            </nav>

            <div class="sidebar-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('appearance-modal').style.display='flex'" style="width:100%; justify-content:center; margin-bottom:10px;">
                    <i class="fa-solid fa-paintbrush"></i> Personalizar
                </button>
                
                <div class="status-widget OFFLINE" id="status-widget">
                    <div class="status-indicator"></div><span id="status-text">OFFLINE</span>
                </div>
            </div>
        </aside>

        <main>
            <header>
                <div class="server-info">
                    <div class="server-title">
                        <h1>Panel de Control</h1>
                        <div class="server-badges">
                             <span class="server-ip-box" onclick="copyIP()"><i class="fa-solid fa-globe"></i> <span id="server-ip-display">...</span></span>
                        </div>
                    </div>
                </div>
                <div class="actions" id="header-actions">
                    <button onclick="api('power/start')" class="btn-control start" data-tooltip="Iniciar"><i class="fa-solid fa-play"></i></button>
                    <button onclick="api('power/restart')" class="btn-control restart" data-tooltip="Reiniciar"><i class="fa-solid fa-rotate"></i></button>
                    <button onclick="api('power/stop')" class="btn-control stop" data-tooltip="Detener"><i class="fa-solid fa-stop"></i></button>
                    <button onclick="api('power/kill')" class="btn-control kill" data-tooltip="Forzar Apagado"><i class="fa-solid fa-skull"></i></button>
                </div>
            </header>

            <div id="tab-stats" class="tab-content active">
                
                <div class="card glass" style="min-height:auto">
                    <div class="card-title"><i class="fa-solid fa-power-off"></i> Control de Energía</div>
                    <div class="power-card-grid">
                        <button onclick="api('power/start')" class="power-btn-large start"><i class="fa-solid fa-play"></i> INICIAR</button>
                        <button onclick="api('power/restart')" class="power-btn-large restart"><i class="fa-solid fa-rotate"></i> REINICIAR</button>
                        <button onclick="api('power/stop')" class="power-btn-large stop"><i class="fa-solid fa-stop"></i> DETENER</button>
                        <button onclick="api('power/kill')" class="power-btn-large kill"><i class="fa-solid fa-skull"></i> KILL</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="card glass">
                        <div class="card-title"><i class="fa-solid fa-microchip"></i> CPU</div>
                        <div class="stat-big" id="cpu-val">0%</div>
                        <div style="font-size:0.8rem; color:var(--muted)">Frecuencia: <span id="cpu-freq">0 GHz</span></div>
                        <div class="chart-mini"><canvas id="cpuChart"></canvas></div>
                    </div>
                    <div class="card glass">
                        <div class="card-title"><i class="fa-solid fa-memory"></i> RAM</div>
                        <div class="stat-big" id="ram-val">0 GB</div>
                        <div style="font-size:0.8rem; color:var(--muted)">Libre: <span id="ram-free">0 GB</span></div>
                        <div class="chart-mini"><canvas id="ramChart"></canvas></div>
                    </div>
                    <div class="card glass">
                        <div class="card-title"><i class="fa-solid fa-hard-drive"></i> Disco</div>
                        <div class="stat-big" id="disk-val">0%</div>
                        <div class="disk-bar" style="height:6px;background:rgba(255,255,255,0.1);border-radius:10px;margin-top:20px;overflow:hidden">
                            <div id="disk-fill" style="height:100%;background:var(--p);width:0%"></div>
                        </div>
                    </div>
                </div>
                
            </div>

            <div id="tab-console" class="tab-content">
                <div class="console-box">
                    <div class="console-header"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div><div style="margin-left:auto; font-size:0.8rem; color:var(--muted)">root@aether-server:~</div></div>
                    <div id="terminal"></div>
                    <div class="console-input-area"><span class="prompt-char">❯</span><input type="text" id="console-input" placeholder="Comando..." onkeydown="if(event.key==='Enter') sendConsoleCommand()"></div>
                </div>
            </div>

            <div id="tab-files" class="tab-content">
                <div class="card glass full">
                    <div class="modal-header" style="border:none; padding:0; margin-bottom:20px"><div class="card-title" style="margin:0"><i class="fa-solid fa-folder-open"></i> Archivos</div><div style="display:flex;gap:10px"><button onclick="loadFileBrowser(currentPath)" class="btn btn-secondary"><i class="fa-solid fa-rotate"></i></button><button onclick="uploadFile()" class="btn btn-primary">Subir</button></div></div>
                    <div id="file-breadcrumb" style="font-family:'JetBrains Mono'; color:var(--p-light); margin-bottom:10px; font-size:0.9rem">/home/container</div>
                    <div id="file-list" class="file-list"></div>
                </div>
            </div>

            <div id="tab-versions" class="tab-content">
                <h2 style="margin-bottom:20px; font-weight:800">Selector de Núcleo</h2>
                <div class="versions-container">
                    <div class="mod-card-modern vanilla" onclick="loadVersions('vanilla')"><div class="mod-cover"><i class="fa-solid fa-cube"></i></div><div class="mod-body"><div class="mod-title">Vanilla</div><p class="mod-desc">La versión oficial de Mojang. Sin modificaciones.</p><button class="btn-install">Seleccionar</button></div></div>
                    <div class="mod-card-modern paper" onclick="loadVersions('paper')"><div class="mod-cover"><i class="fa-solid fa-paper-plane"></i></div><div class="mod-body"><div class="mod-title">Paper</div><p class="mod-desc">Alto rendimiento y optimización para servers.</p><button class="btn-install">Seleccionar</button></div></div>
                    <div class="mod-card-modern fabric" onclick="loadVersions('fabric')"><div class="mod-cover"><i class="fa-solid fa-scroll"></i></div><div class="mod-body"><div class="mod-title">Fabric</div><p class="mod-desc">Ligero, modular y perfecto para mods técnicos.</p><button class="btn-install">Seleccionar</button></div></div>
                    <div class="mod-card-modern forge" onclick="loadVersions('forge')"><div class="mod-cover"><i class="fa-solid fa-hammer"></i></div><div class="mod-body"><div class="mod-title">Forge</div><p class="mod-desc">El estándar clásico para mods pesados.</p><button class="btn-install">Seleccionar</button></div></div>
                </div>
            </div>

            <div id="tab-labs" class="tab-content">
                <h2 style="margin-bottom:10px; font-weight:800">Aether Labs</h2>
                <div class="labs-grid">
                    <div class="mod-card-modern lab-purple">
                        <span class="lab-tag new">NUEVO</span> <div class="mod-cover"><i class="fa-solid fa-puzzle-piece"></i></div>
                        <div class="mod-body"><div class="mod-title">Tienda de Mods</div><p class="mod-desc">Instala plugins y mods fácilmente.</p><button class="btn-install" onclick="openModStore()">Abrir Tienda</button></div>
                    </div>
                    
                    <div class="mod-card-modern lab-teal">
                        <span class="lab-tag beta">BETA</span> <div class="mod-cover"><i class="fa-solid fa-bolt"></i></div>
                        <div class="mod-body"><div class="mod-title">Modo Turbo</div><p class="mod-desc">Prioridad alta al proceso Java.</p><div style="margin-top:auto; display:flex; justify-content:space-between; align-items:center"><span style="font-size:0.8rem; font-weight:700; color:var(--muted)">ESTADO</span><label class="switch"><input type="checkbox" id="lab-turbo"><span class="slider round"></span></label></div></div>
                    </div>
                    
                    <div class="mod-card-modern lab-orange">
                        <span class="lab-tag alpha">ALPHA</span> <div class="mod-cover"><i class="fa-solid fa-folder-tree"></i></div>
                        <div class="mod-body"><div class="mod-title">Gestor de Archivos</div><p class="mod-desc">Explorador avanzado (Alpha).</p><button class="btn-install" onclick="setTab('files')">Abrir Gestor</button></div>
                    </div>
                    
                    <div class="mod-card-modern lab-blue">
                        <span class="lab-tag alpha">ALPHA</span>
                        <div class="mod-cover"><i class="fa-solid fa-box-archive"></i></div>
                        <div class="mod-body"><div class="mod-title">Backups</div><p class="mod-desc">Gestión de copias de seguridad.</p><button class="btn-install" onclick="setTab('backups')">Abrir Backups</button></div>
                    </div>

                    <div class="mod-card-modern lab-red">
                        <span class="lab-tag wip">WIP</span> <div class="mod-cover"><i class="fa-solid fa-calendar-days"></i></div>
                        <div class="mod-body"><div class="mod-title">Programador</div><p class="mod-desc">Automatiza reinicios y comandos.</p><button class="btn-install" disabled>Próximamente</button></div>
                    </div>

                    <div class="mod-card-modern lab-indigo">
                        <span class="lab-tag wip">WIP</span> <div class="mod-cover"><i class="fa-solid fa-network-wired"></i></div>
                        <div class="mod-body"><div class="mod-title">Red & Puertos</div><p class="mod-desc">Gestión avanzada de puertos y proxy.</p><button class="btn-install" disabled>Próximamente</button></div>
                    </div>
                </div>
            </div>
            
            <div id="tab-whitelist" class="tab-content">
                <div class="card glass full">
                    <div class="modal-header" style="border:none; padding:0; margin-bottom:20px; flex-wrap: wrap; gap: 15px;">
                        <div class="card-title" style="margin:0"><i class="fa-solid fa-address-book"></i> Whitelist</div>
                        <div style="display:flex; align-items:center; gap:10px; margin-left: auto;">
                            <span style="font-size:0.8rem; font-weight:700; color:var(--muted)">ESTADO</span>
                            <label class="switch">
                                <input type="checkbox" id="wl-toggle" onchange="toggleWL(this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="whitelist-input-container">
                        <div class="wl-input-wrapper">
                            <i class="fa-solid fa-user-plus"></i>
                            <input type="text" id="wl-input" placeholder="Nombre de usuario de Minecraft..." onkeypress="handleWLKey(event)">
                        </div>
                        <button class="btn btn-primary" onclick="addWL()">Añadir</button>
                    </div>

                    <div id="wl-grid" class="whitelist-grid">
                        </div>
                    
                    <div id="wl-empty" style="display:none; flex-direction:column; align-items:center; justify-content:center; flex:1; color:var(--muted); opacity:0.6">
                        <i class="fa-solid fa-users-slash" style="font-size:3rem; margin-bottom:10px"></i>
                        <p>La whitelist está vacía.</p>
                    </div>
                </div>
            </div>

            <div id="tab-config" class="tab-content">
                <div class="card glass" style="min-height: auto; overflow: visible;">
                    <div class="modal-header" style="border:none; padding:0; margin-bottom:20px">
                        <div class="card-title"><i class="fa-solid fa-sliders"></i> Ajustes</div>
                        <button onclick="saveCfg()" class="btn btn-primary" style="padding:10px 30px; font-size:1rem;">Guardar Cambios</button>
                    </div>
                    
                    <div id="cfg-list" class="cfg-grid"></div>
                </div>
                <div style="height: 50px;"></div>
            </div>

            <div id="tab-backups" class="tab-content">
                <div class="card glass full">
                     <div class="modal-header" style="border:none; padding:0; margin-bottom:20px"><div class="card-title"><i class="fa-solid fa-box-archive"></i> Copias de Seguridad</div><button onclick="createBackup()" class="btn btn-primary">Crear Backup</button></div>
                     <button onclick="setTab('labs')" class="btn btn-ghost" style="margin-bottom:20px; width:fit-content"><i class="fa-solid fa-arrow-left"></i> Volver a Labs</button>
                    <div id="backup-list" class="file-list"></div>
                </div>
            </div>
        </main>
    </div>
    <script src="app.js"></script>
</body>
</html>
